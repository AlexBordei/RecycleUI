---
phase: 01-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified: [app/Models/User.php, database/migrations/, app/Providers/Filament/, config/filament.php]
autonomous: true
---

<objective>
Install Filament v3 and configure User model with username authentication.

Purpose: Establish admin panel framework and user model with username field (not email) for login.
Output: Filament admin panel accessible with User model ready for authentication.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Filament v3 and create admin panel</name>
  <files>composer.json, config/filament.php, app/Providers/Filament/AdminPanelProvider.php</files>
  <action>
    Install Filament v3:
    ```
    composer require filament/filament:"^3.2"
    php artisan filament:install --panels
    ```

    When prompted for panel ID, use "admin".

    This creates:
    - AdminPanelProvider.php in app/Providers/Filament/
    - Filament configuration
    - Required assets
  </action>
  <verify>php artisan route:list | grep filament shows admin routes</verify>
  <done>Filament v3 installed with admin panel at /admin</done>
</task>

<task type="auto">
  <name>Task 2: Configure User model for username authentication</name>
  <files>app/Models/User.php, database/migrations/*_create_users_table.php</files>
  <action>
    Modify User model and migration for username-based auth:

    1. Update the existing users migration (database/migrations/*_create_users_table.php):
       - Add `username` column (string, unique) - used for login
       - Keep `email` column (string, unique, nullable) - used for password reset
       - Add `full_name` column (string) - used for filesystem paths
       - Add `is_admin` column (boolean, default false)
       - Add `is_active` column (boolean, default true)

    2. Update User model (app/Models/User.php):
       - Add username, full_name, is_admin, is_active to $fillable
       - Implement FilamentUser interface for Filament access
       - Add canAccessPanel() method checking is_active

    3. Run migration:
       ```
       php artisan migrate
       ```

    Note: Username format example: "alexbordei"
    Full name format example: "ALEXANDRU-IONEL BORDEI" (used in paths)
  </action>
  <verify>php artisan migrate:status shows users table migrated, php artisan tinker with User::query() works</verify>
  <done>User model has username, full_name, is_admin, is_active columns. Migration complete.</done>
</task>

<task type="auto">
  <name>Task 3: Configure Filament for username login</name>
  <files>app/Providers/Filament/AdminPanelProvider.php, app/Http/Livewire/Auth/ (if needed)</files>
  <action>
    Configure AdminPanelProvider for username-based authentication:

    1. In AdminPanelProvider.php:
       - Set login path to /admin/login
       - Enable authentication
       - Set authGuard to 'web'

    2. Override the default login form to use username instead of email:
       - Create custom login page that accepts username field
       - Use `Auth::attempt(['username' => $username, 'password' => $password])`

    3. Create a seeder for initial admin user:
       ```php
       // database/seeders/AdminUserSeeder.php
       User::create([
           'username' => 'admin',
           'email' => null,
           'full_name' => 'Administrator',
           'password' => Hash::make('password'),
           'is_admin' => true,
           'is_active' => true,
       ]);
       ```

    4. Run seeder:
       ```
       php artisan db:seed --class=AdminUserSeeder
       ```
  </action>
  <verify>Visit http://localhost:8000/admin shows login page with username field, can login with admin/password</verify>
  <done>Filament admin panel uses username for login, default admin user created</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `composer show filament/filament` shows v3.2+
- [ ] `/admin` route exists and shows login page
- [ ] Login page has username field (not email)
- [ ] Can login with admin/password
- [ ] User model has username, full_name, is_admin, is_active columns
</verification>

<success_criteria>
- Filament v3 installed and configured
- User model supports username authentication
- Admin user seeded and can login
- Session persists (AUTH-03)
- Logout works (AUTH-02)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
