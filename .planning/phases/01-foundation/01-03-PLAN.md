---
phase: 01-foundation
plan: 03
type: execute
wave: 3
depends_on: ["01-02"]
files_modified: [config/mail.php, config/filesystems.php, .env, app/Notifications/]
autonomous: false
user_setup:
  - service: resend
    why: "Email delivery for password reset"
    env_vars:
      - name: RESEND_API_KEY
        source: "Resend Dashboard → API Keys → Create API Key"
    account_setup:
      - url: "https://resend.com/signup"
        skip_if: "Already have Resend account"
    dashboard_config:
      - task: "Verify sending domain (optional for dev)"
        location: "Resend Dashboard → Domains"
        details: "Can use default onboarding@resend.dev for development"
---

<objective>
Configure password reset with Resend API and set up custom filesystem disks.

Purpose: Complete authentication features (AUTH-04) and prepare filesystem for file operations.
Output: Working password reset flow and configured filesystem disks for Processing/Done paths.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install and configure Resend for email</name>
  <files>composer.json, config/mail.php, .env, .env.example</files>
  <action>
    Install Resend Laravel package:
    ```
    composer require resend/resend-laravel
    ```

    Configure mail in .env:
    ```
    MAIL_MAILER=resend
    RESEND_API_KEY=re_placeholder_key
    MAIL_FROM_ADDRESS="noreply@recycleui.local"
    MAIL_FROM_NAME="RecycleUI"
    ```

    Update .env.example with same structure (without API key value).

    Publish Resend config:
    ```
    php artisan vendor:publish --tag=resend-config
    ```
  </action>
  <verify>composer show resend/resend-laravel shows package installed, config/resend.php exists</verify>
  <done>Resend package installed and configured in .env</done>
</task>

<task type="auto">
  <name>Task 2: Configure password reset for username-based users</name>
  <files>app/Models/User.php, app/Notifications/ResetPasswordNotification.php, routes/web.php</files>
  <action>
    Since users login with username but need email for password reset:

    1. Ensure User model uses Notifiable trait and implements CanResetPassword

    2. Create custom password reset notification:
       ```php
       // app/Notifications/ResetPasswordNotification.php
       // Uses Resend to send reset link
       ```

    3. Override the sendPasswordResetNotification in User model to use custom notification

    4. Configure password reset routes in Filament panel or via standard Laravel routes

    Note: Users must have email set to receive password reset. Show appropriate error if email is null.
  </action>
  <verify>Password reset form exists, submitting with valid email sends reset request (will fail without valid Resend key, but code path works)</verify>
  <done>Password reset flow configured, ready to work once Resend API key is set</done>
</task>

<task type="auto">
  <name>Task 3: Configure custom filesystem disks</name>
  <files>config/filesystems.php, .env</files>
  <action>
    Add custom filesystem disks in config/filesystems.php:

    ```php
    'disks' => [
        // ... existing disks

        'processing' => [
            'driver' => 'local',
            'root' => env('SIATD_PROCESSING_PATH', storage_path('app/siatd/processing')),
            'throw' => false,
        ],

        'done' => [
            'driver' => 'local',
            'root' => env('SIATD_DONE_PATH', storage_path('app/siatd/done')),
            'throw' => false,
        ],
    ],
    ```

    Add to .env:
    ```
    SIATD_PROCESSING_PATH="${HOME}/Desktop/SIATD/Processing"
    SIATD_DONE_PATH="${HOME}/Desktop/SIATD/Done"
    ```

    Create helper method or service for generating user paths:
    - Format: [User Full Name]/[DD-MM-YYYY HH:mm]/
    - Handle spaces in full names (they work fine on macOS filesystem)
  </action>
  <verify>php artisan tinker with Storage::disk('processing')->path('') shows correct path</verify>
  <done>Custom disks 'processing' and 'done' configured with correct paths</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete authentication system with Filament, username login, password reset, and filesystem configuration</what-built>
  <how-to-verify>
    1. Start server: php artisan serve
    2. Visit: http://localhost:8000/admin
    3. Verify: Login page shows username field (not email)
    4. Login with: admin / password
    5. Verify: Dashboard loads, user is authenticated
    6. Click logout: Session ends, redirected to login
    7. Check password reset link exists on login page
    8. Verify in terminal: php artisan tinker
       - Storage::disk('processing')->path('') → shows ~/Desktop/SIATD/Processing
       - Storage::disk('done')->path('') → shows ~/Desktop/SIATD/Done
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Resend package installed
- [ ] Password reset notification configured
- [ ] 'processing' disk points to ~/Desktop/SIATD/Processing
- [ ] 'done' disk points to ~/Desktop/SIATD/Done
- [ ] Full auth flow works (login, session, logout)
</verification>

<success_criteria>
- AUTH-01: Login with username/password works ✓
- AUTH-02: Logout works ✓
- AUTH-03: Session persists across refresh ✓
- AUTH-04: Password reset configured (needs Resend API key to test fully)
- Filesystem disks ready for Phase 4
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md`
</output>
